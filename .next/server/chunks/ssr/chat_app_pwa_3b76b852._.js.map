{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/lib/api.ts"],"sourcesContent":["const API_BASE_URL = \"https://api.tools.gavago.fr/socketio/api\";\r\n\r\nexport interface ApiResponse<T> {\r\n  success?: boolean;\r\n  data?: T;\r\n  error?: string;\r\n  [key: string]: unknown;\r\n}\r\n\r\nexport interface ImageUploadResponse {\r\n  success: boolean;\r\n  message?: string;\r\n}\r\n\r\nexport interface ImageGetResponse {\r\n  success: boolean;\r\n  data_image?: string;\r\n}\r\n\r\nexport async function fetchData<T>(endpoint: string): Promise<ApiResponse<T>> {\r\n  try {\r\n    const headers = {\r\n      \"Content-Type\": \"application/json\",\r\n      \"Accept\": \"application/json\",\r\n    };\r\n\r\n    const url = `${API_BASE_URL}${endpoint}`;\r\n\r\n    const res = await fetch(url, {\r\n      headers\r\n    });\r\n\r\n    if (!res.ok) {\r\n      throw new Error(`Erreur HTTP! Statut: ${res.status}`);\r\n    }\r\n\r\n    const data = await res.json();\r\n    return data;\r\n  } catch (error) {\r\n    return { error: (error as Error).message };\r\n  }\r\n}\r\n\r\nexport async function sendImage(socketId: string, imageData: string): Promise<ApiResponse<ImageUploadResponse>> {\r\n  try {\r\n    const headers = {\r\n      \"Content-Type\": \"application/json\",\r\n    };\r\n\r\n    // Utiliser le proxy local pour √©viter les probl√®mes CORS\r\n    const url = `/api/images`;\r\n\r\n    const res = await fetch(url, {\r\n      method: \"POST\",\r\n      headers,\r\n      body: JSON.stringify({\r\n        id: socketId,\r\n        image_data: imageData\r\n      })\r\n    });\r\n\r\n    if (!res.ok) {\r\n      throw new Error(`Erreur HTTP! Statut: ${res.status}`);\r\n    }\r\n\r\n    const data = await res.json();\r\n    return data;\r\n  } catch (error) {\r\n    return { error: (error as Error).message };\r\n  }\r\n}\r\n\r\nexport async function getImage(imageId: string): Promise<ApiResponse<ImageGetResponse>> {\r\n  try {\r\n    const headers = {\r\n      \"Content-Type\": \"application/json\",\r\n      \"Accept\": \"application/json\",\r\n    };\r\n\r\n    // Utiliser le proxy local pour √©viter les probl√®mes CORS\r\n    const url = `/api/images?id=${imageId}`;\r\n\r\n    const res = await fetch(url, {\r\n      headers\r\n    });\r\n\r\n    if (!res.ok) {\r\n      throw new Error(`Erreur HTTP! Statut: ${res.status}`);\r\n    }\r\n\r\n    const data = await res.json();\r\n    return data;\r\n  } catch (error) {\r\n    return { error: (error as Error).message };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,eAAe;AAmBd,eAAe,UAAa,QAAgB;IACjD,IAAI;QACF,MAAM,UAAU;YACd,gBAAgB;YAChB,UAAU;QACZ;QAEA,MAAM,MAAM,GAAG,eAAe,UAAU;QAExC,MAAM,MAAM,MAAM,MAAM,KAAK;YAC3B;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,IAAI,MAAM,CAAC,qBAAqB,EAAE,IAAI,MAAM,EAAE;QACtD;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;YAAE,OAAO,AAAC,MAAgB,OAAO;QAAC;IAC3C;AACF;AAEO,eAAe,UAAU,QAAgB,EAAE,SAAiB;IACjE,IAAI;QACF,MAAM,UAAU;YACd,gBAAgB;QAClB;QAEA,yDAAyD;QACzD,MAAM,MAAM,CAAC,WAAW,CAAC;QAEzB,MAAM,MAAM,MAAM,MAAM,KAAK;YAC3B,QAAQ;YACR;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,IAAI;gBACJ,YAAY;YACd;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,IAAI,MAAM,CAAC,qBAAqB,EAAE,IAAI,MAAM,EAAE;QACtD;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;YAAE,OAAO,AAAC,MAAgB,OAAO;QAAC;IAC3C;AACF;AAEO,eAAe,SAAS,OAAe;IAC5C,IAAI;QACF,MAAM,UAAU;YACd,gBAAgB;YAChB,UAAU;QACZ;QAEA,yDAAyD;QACzD,MAAM,MAAM,CAAC,eAAe,EAAE,SAAS;QAEvC,MAAM,MAAM,MAAM,MAAM,KAAK;YAC3B;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,IAAI,MAAM,CAAC,qBAAqB,EAAE,IAAI,MAAM,EAAE;QACtD;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;YAAE,OAAO,AAAC,MAAgB,OAAO;QAAC;IAC3C;AACF","debugId":null}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/chat/MessageBubble.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { MessageBubbleProps } from \"@/types/chat\";\r\nimport { getImage } from \"@/lib/api\";\r\n\r\nexport default function MessageBubble({ message, isOwnMessage, onImageClick }: MessageBubbleProps) {\r\n    const [imgData, setImgData] = useState<string | null>(message.imageData || null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Mettre √† jour si les props changent\r\n        if (message.imageData) {\r\n            setImgData(message.imageData);\r\n        }\r\n    }, [message.imageData]);\r\n\r\n    useEffect(() => {\r\n        // Si on a un ID mais pas de donn√©es, on charge l'image\r\n        if (message.imageId && !imgData && !loading) {\r\n            const fetchImage = async () => {\r\n                setLoading(true);\r\n                const response = await getImage(message.imageId!);\r\n                if (response.success && response.data_image) {\r\n                    setImgData(response.data_image as string);\r\n                }\r\n                setLoading(false);\r\n            };\r\n            fetchImage();\r\n        }\r\n    }, [message.imageId, imgData]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    const date = new Date(message.dateEmis ?? Date.now());\r\n    const now = new Date();\r\n    const isToday =\r\n        date.getDate() === now.getDate() &&\r\n        date.getMonth() === now.getMonth() &&\r\n        date.getFullYear() === now.getFullYear();\r\n\r\n    const pad = (n: number) => n.toString().padStart(2, \"0\");\r\n    const hours = pad(date.getHours());\r\n    const minutes = pad(date.getMinutes());\r\n    const formattedDate = isToday\r\n        ? `${hours}:${minutes}`\r\n        : `${pad(date.getDate())}/${pad(date.getMonth() + 1)}/${date.getFullYear()} - ${hours}:${minutes}`;\r\n\r\n    const hasImage = imgData || message.imageId;\r\n\r\n    return (\r\n        <div className={`w-full flex ${isOwnMessage ? 'justify-end' : 'justify-start'} items-center mb-2`}>\r\n            <div className={`flex flex-col gap-1.5 px-3 py-1 rounded-lg w-fit max-w-[70%] ${isOwnMessage ? 'bg-violet-600 text-white' : 'bg-gray-200 text-gray-800'\r\n                }`}>\r\n                <p className=\"text-[12px] break-words\">\r\n                    {message.pseudo || message.userId || \"Anonyme\"}{\" \"}\r\n                    <span className={`text-[10px] italic ${isOwnMessage ? 'text-white' : 'text-gray-500'\r\n                        }`}>{formattedDate}</span>\r\n                </p>\r\n                {hasImage ? (\r\n                    <div\r\n                        className=\"cursor-pointer rounded overflow-hidden relative min-h-[50px] min-w-[50px] flex items-center justify-center bg-black/5\"\r\n                        onClick={() => imgData && onImageClick(imgData)}\r\n                    >\r\n                        {imgData ? (\r\n                            <img\r\n                                src={imgData}\r\n                                alt=\"Image partag√©e\"\r\n                                className=\"max-w-full h-auto rounded\"\r\n                                style={{ maxHeight: '200px' }}\r\n                            />\r\n                        ) : (\r\n                            <div className=\"p-4 flex flex-col items-center gap-2\">\r\n                                <div className=\"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin\"></div>\r\n                                <span className=\"text-xs opacity-70\">Chargement...</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <p className=\"break-words\">\r\n                        {message.content.split(/(https?:\\/\\/[^\\s]+)/g).map((part, index) =>\r\n                            part.match(/https?:\\/\\/[^\\s]+/) ? (\r\n                                <a\r\n                                    key={index}\r\n                                    href={part}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className={`underline cursor-pointer hover:opacity-80 break-all ${isOwnMessage ? 'text-white' : 'text-blue-600'}`}\r\n                                >\r\n                                    {part}\r\n                                </a>\r\n                            ) : (\r\n                                part\r\n                            )\r\n                        )}\r\n                    </p>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AAJA;;;;AAMe,SAAS,cAAc,EAAE,OAAO,EAAE,YAAY,EAAE,YAAY,EAAsB;IAC7F,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iOAAQ,EAAgB,QAAQ,SAAS,IAAI;IAC3E,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iOAAQ,EAAC;IAEvC,IAAA,kOAAS,EAAC;QACN,sCAAsC;QACtC,IAAI,QAAQ,SAAS,EAAE;YACnB,WAAW,QAAQ,SAAS;QAChC;IACJ,GAAG;QAAC,QAAQ,SAAS;KAAC;IAEtB,IAAA,kOAAS,EAAC;QACN,uDAAuD;QACvD,IAAI,QAAQ,OAAO,IAAI,CAAC,WAAW,CAAC,SAAS;YACzC,MAAM,aAAa;gBACf,WAAW;gBACX,MAAM,WAAW,MAAM,IAAA,sIAAQ,EAAC,QAAQ,OAAO;gBAC/C,IAAI,SAAS,OAAO,IAAI,SAAS,UAAU,EAAE;oBACzC,WAAW,SAAS,UAAU;gBAClC;gBACA,WAAW;YACf;YACA;QACJ;IACJ,GAAG;QAAC,QAAQ,OAAO;QAAE;KAAQ,GAAG,kDAAkD;IAElF,MAAM,OAAO,IAAI,KAAK,QAAQ,QAAQ,IAAI,KAAK,GAAG;IAClD,MAAM,MAAM,IAAI;IAChB,MAAM,UACF,KAAK,OAAO,OAAO,IAAI,OAAO,MAC9B,KAAK,QAAQ,OAAO,IAAI,QAAQ,MAChC,KAAK,WAAW,OAAO,IAAI,WAAW;IAE1C,MAAM,MAAM,CAAC,IAAc,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG;IACpD,MAAM,QAAQ,IAAI,KAAK,QAAQ;IAC/B,MAAM,UAAU,IAAI,KAAK,UAAU;IACnC,MAAM,gBAAgB,UAChB,GAAG,MAAM,CAAC,EAAE,SAAS,GACrB,GAAG,IAAI,KAAK,OAAO,IAAI,CAAC,EAAE,IAAI,KAAK,QAAQ,KAAK,GAAG,CAAC,EAAE,KAAK,WAAW,GAAG,GAAG,EAAE,MAAM,CAAC,EAAE,SAAS;IAEtG,MAAM,WAAW,WAAW,QAAQ,OAAO;IAE3C,qBACI,8PAAC;QAAI,WAAW,CAAC,YAAY,EAAE,eAAe,gBAAgB,gBAAgB,kBAAkB,CAAC;kBAC7F,cAAA,8PAAC;YAAI,WAAW,CAAC,6DAA6D,EAAE,eAAe,6BAA6B,6BACtH;;8BACF,8PAAC;oBAAE,WAAU;;wBACR,QAAQ,MAAM,IAAI,QAAQ,MAAM,IAAI;wBAAW;sCAChD,8PAAC;4BAAK,WAAW,CAAC,mBAAmB,EAAE,eAAe,eAAe,iBAC/D;sCAAG;;;;;;;;;;;;gBAEZ,yBACG,8PAAC;oBACG,WAAU;oBACV,SAAS,IAAM,WAAW,aAAa;8BAEtC,wBACG,8PAAC;wBACG,KAAK;wBACL,KAAI;wBACJ,WAAU;wBACV,OAAO;4BAAE,WAAW;wBAAQ;;;;;6CAGhC,8PAAC;wBAAI,WAAU;;0CACX,8PAAC;gCAAI,WAAU;;;;;;0CACf,8PAAC;gCAAK,WAAU;0CAAqB;;;;;;;;;;;;;;;;yCAKjD,8PAAC;oBAAE,WAAU;8BACR,QAAQ,OAAO,CAAC,KAAK,CAAC,wBAAwB,GAAG,CAAC,CAAC,MAAM,QACtD,KAAK,KAAK,CAAC,qCACP,8PAAC;4BAEG,MAAM;4BACN,QAAO;4BACP,KAAI;4BACJ,WAAW,CAAC,oDAAoD,EAAE,eAAe,eAAe,iBAAiB;sCAEhH;2BANI;;;;mCAST;;;;;;;;;;;;;;;;;AAQhC","debugId":null}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/chat/ImagePreview.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { ImagePreviewProps } from \"@/types/chat\";\r\n\r\nexport default function ImagePreview({ imageData, onDelete }: ImagePreviewProps) {\r\n    return (\r\n        <div className=\"mb-2 relative flex justify-end\">\r\n            <img\r\n                src={imageData}\r\n                alt=\"Pr√©visualisation\"\r\n                className=\"rounded-lg shadow-lg max-h-40 object-contain\"\r\n            />\r\n            <button\r\n                onClick={onDelete}\r\n                className=\"absolute -top-2 -right-2 w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors\"\r\n            >\r\n                ‚úï\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAIe,SAAS,aAAa,EAAE,SAAS,EAAE,QAAQ,EAAqB;IAC3E,qBACI,8PAAC;QAAI,WAAU;;0BACX,8PAAC;gBACG,KAAK;gBACL,KAAI;gBACJ,WAAU;;;;;;0BAEd,8PAAC;gBACG,SAAS;gBACT,WAAU;0BACb;;;;;;;;;;;;AAKb","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/chat/CameraView.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRef, useEffect, useState } from \"react\";\r\nimport { CameraViewProps } from \"@/types/chat\";\r\n\r\nexport default function CameraView({ onPhotoTaken, onClose }: CameraViewProps) {\r\n    const videoRef = useRef<HTMLVideoElement | null>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        let localStream: MediaStream | null = null;\r\n\r\n        async function initCamera() {\r\n            try {\r\n                const mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n\r\n                // Si le composant a √©t√© d√©mont√© entre temps, on coupe tout de suite\r\n                if (!isMounted) {\r\n                    mediaStream.getTracks().forEach(track => track.stop());\r\n                    return;\r\n                }\r\n\r\n                localStream = mediaStream;\r\n                if (videoRef.current) {\r\n                    videoRef.current.srcObject = mediaStream;\r\n                }\r\n                setStream(mediaStream);\r\n            } catch (err) {\r\n                // Camera access denied or not available\r\n            }\r\n        }\r\n\r\n        initCamera();\r\n\r\n        return () => {\r\n            isMounted = false;\r\n            // Nettoyage principal lors du d√©montage\r\n            if (localStream) {\r\n                localStream.getTracks().forEach((track) => track.stop());\r\n            }\r\n            // S√©curit√© : V√©rifier si le state stream contient quelque chose\r\n            if (stream) {\r\n                stream.getTracks().forEach((track) => track.stop());\r\n            }\r\n        };\r\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    const takePhoto = () => {\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n        const video = videoRef.current;\r\n        const canvas = canvasRef.current;\r\n\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n\r\n        const context = canvas.getContext(\"2d\");\r\n        if (!context) return;\r\n\r\n        // Appliquer l'effet miroir √† la capture\r\n        context.translate(canvas.width, 0);\r\n        context.scale(-1, 1);\r\n\r\n        context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n        const photoData = canvas.toDataURL(\"image/jpeg\", 0.7);\r\n\r\n        // Sauvegarder dans la galerie locale\r\n        const storedPhotos = JSON.parse(localStorage.getItem(\"photos\") || \"[]\");\r\n        storedPhotos.push(photoData);\r\n        localStorage.setItem(\"photos\", JSON.stringify(storedPhotos));\r\n\r\n        onPhotoTaken(photoData);\r\n    };\r\n\r\n    const handleClose = () => {\r\n        if (stream) {\r\n            stream.getTracks().forEach((track) => track.stop());\r\n        }\r\n        onClose();\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 w-full h-full bg-white z-50\">\r\n            <canvas ref={canvasRef} style={{ display: \"none\" }} />\r\n            <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                playsInline\r\n                className=\"absolute top-0 left-0 w-full h-full object-cover scale-x-[-1]\"\r\n            />\r\n\r\n            <div className=\"absolute bottom-8 w-full flex justify-center gap-8\">\r\n                <button\r\n                    onClick={takePhoto}\r\n                    className=\"w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-lg border-4 border-gray-300\"\r\n                >\r\n                    üì∏\r\n                </button>\r\n                <button\r\n                    onClick={handleClose}\r\n                    className=\"w-16 h-16 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg\"\r\n                >\r\n                    X\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAKe,SAAS,WAAW,EAAE,YAAY,EAAE,OAAO,EAAmB;IACzE,MAAM,WAAW,IAAA,+NAAM,EAA0B;IACjD,MAAM,YAAY,IAAA,+NAAM,EAA2B;IACnD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iOAAQ,EAAqB;IAEzD,IAAA,kOAAS,EAAC;QACN,IAAI,YAAY;QAChB,IAAI,cAAkC;QAEtC,eAAe;YACX,IAAI;gBACA,MAAM,cAAc,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;oBAAE,OAAO;gBAAK;gBAE5E,oEAAoE;gBACpE,IAAI,CAAC,WAAW;oBACZ,YAAY,SAAS,GAAG,OAAO,CAAC,CAAA,QAAS,MAAM,IAAI;oBACnD;gBACJ;gBAEA,cAAc;gBACd,IAAI,SAAS,OAAO,EAAE;oBAClB,SAAS,OAAO,CAAC,SAAS,GAAG;gBACjC;gBACA,UAAU;YACd,EAAE,OAAO,KAAK;YACV,wCAAwC;YAC5C;QACJ;QAEA;QAEA,OAAO;YACH,YAAY;YACZ,wCAAwC;YACxC,IAAI,aAAa;gBACb,YAAY,SAAS,GAAG,OAAO,CAAC,CAAC,QAAU,MAAM,IAAI;YACzD;YACA,gEAAgE;YAChE,IAAI,QAAQ;gBACR,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,QAAU,MAAM,IAAI;YACpD;QACJ;IACJ,GAAG,EAAE,GAAG,kDAAkD;IAE1D,MAAM,YAAY;QACd,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,UAAU,OAAO,EAAE;QAC7C,MAAM,QAAQ,SAAS,OAAO;QAC9B,MAAM,SAAS,UAAU,OAAO;QAEhC,OAAO,KAAK,GAAG,MAAM,UAAU;QAC/B,OAAO,MAAM,GAAG,MAAM,WAAW;QAEjC,MAAM,UAAU,OAAO,UAAU,CAAC;QAClC,IAAI,CAAC,SAAS;QAEd,wCAAwC;QACxC,QAAQ,SAAS,CAAC,OAAO,KAAK,EAAE;QAChC,QAAQ,KAAK,CAAC,CAAC,GAAG;QAElB,QAAQ,SAAS,CAAC,OAAO,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;QAE1D,MAAM,YAAY,OAAO,SAAS,CAAC,cAAc;QAEjD,qCAAqC;QACrC,MAAM,eAAe,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,aAAa;QAClE,aAAa,IAAI,CAAC;QAClB,aAAa,OAAO,CAAC,UAAU,KAAK,SAAS,CAAC;QAE9C,aAAa;IACjB;IAEA,MAAM,cAAc;QAChB,IAAI,QAAQ;YACR,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,QAAU,MAAM,IAAI;QACpD;QACA;IACJ;IAEA,qBACI,8PAAC;QAAI,WAAU;;0BACX,8PAAC;gBAAO,KAAK;gBAAW,OAAO;oBAAE,SAAS;gBAAO;;;;;;0BACjD,8PAAC;gBACG,KAAK;gBACL,QAAQ;gBACR,WAAW;gBACX,WAAU;;;;;;0BAGd,8PAAC;gBAAI,WAAU;;kCACX,8PAAC;wBACG,SAAS;wBACT,WAAU;kCACb;;;;;;kCAGD,8PAAC;wBACG,SAAS;wBACT,WAAU;kCACb;;;;;;;;;;;;;;;;;;AAMjB","debugId":null}},
    {"offset": {"line": 407, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/chat/GalleryModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { GalleryModalProps } from \"@/types/chat\";\r\n\r\nexport default function GalleryModal({ isOpen, onClose, onSelectPhoto }: GalleryModalProps) {\r\n    const [galleryPhotos, setGalleryPhotos] = useState<string[]>([]);\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            const storedPhotos = JSON.parse(localStorage.getItem(\"photos\") || \"[]\");\r\n            setGalleryPhotos(storedPhotos.reverse());\r\n        }\r\n    }, [isOpen]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div\r\n            className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\"\r\n            onClick={onClose}\r\n        >\r\n            <div\r\n                className=\"bg-white rounded-lg p-6 max-w-4xl max-h-[90vh] overflow-y-auto\"\r\n                onClick={(e) => e.stopPropagation()}\r\n            >\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <h2 className=\"text-2xl font-bold text-gray-800\">Galerie</h2>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors\"\r\n                    >\r\n                        ‚úï\r\n                    </button>\r\n                </div>\r\n\r\n                {galleryPhotos.length === 0 ? (\r\n                    <p className=\"text-gray-500 text-center py-8\">Aucune photo dans la galerie</p>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n                        {galleryPhotos.map((photoData, index) => (\r\n                            <div\r\n                                key={index}\r\n                                className=\"relative cursor-pointer group\"\r\n                                onClick={() => onSelectPhoto(photoData)}\r\n                            >\r\n                                <img\r\n                                    src={photoData}\r\n                                    alt={`Photo ${index + 1}`}\r\n                                    className=\"w-full h-32 object-cover rounded-lg shadow-md group-hover:shadow-xl transition-shadow\"\r\n                                />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAKe,SAAS,aAAa,EAAE,MAAM,EAAE,OAAO,EAAE,aAAa,EAAqB;IACtF,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iOAAQ,EAAW,EAAE;IAE/D,IAAA,kOAAS,EAAC;QACN,IAAI,QAAQ;YACR,MAAM,eAAe,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,aAAa;YAClE,iBAAiB,aAAa,OAAO;QACzC;IACJ,GAAG;QAAC;KAAO;IAEX,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACI,8PAAC;QACG,WAAU;QACV,SAAS;kBAET,cAAA,8PAAC;YACG,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAEjC,8PAAC;oBAAI,WAAU;;sCACX,8PAAC;4BAAG,WAAU;sCAAmC;;;;;;sCACjD,8PAAC;4BACG,SAAS;4BACT,WAAU;sCACb;;;;;;;;;;;;gBAKJ,cAAc,MAAM,KAAK,kBACtB,8PAAC;oBAAE,WAAU;8BAAiC;;;;;yCAE9C,8PAAC;oBAAI,WAAU;8BACV,cAAc,GAAG,CAAC,CAAC,WAAW,sBAC3B,8PAAC;4BAEG,WAAU;4BACV,SAAS,IAAM,cAAc;sCAE7B,cAAA,8PAAC;gCACG,KAAK;gCACL,KAAK,CAAC,MAAM,EAAE,QAAQ,GAAG;gCACzB,WAAU;;;;;;2BAPT;;;;;;;;;;;;;;;;;;;;;AAgBrC","debugId":null}},
    {"offset": {"line": 507, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/chat/ImageViewer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { ImageViewerProps } from \"@/types/chat\";\r\n\r\nexport default function ImageViewer({ imageData, onClose }: ImageViewerProps) {\r\n    if (!imageData) return null;\r\n\r\n    return (\r\n        <div\r\n            className=\"bg-black/70 fixed inset-0 flex items-center justify-center z-50\"\r\n            onClick={onClose}\r\n        >\r\n            <div className=\"relative max-w-4xl max-h-[90vh] p-4\">\r\n                <img\r\n                    src={imageData}\r\n                    alt=\"Image agrandie\"\r\n                    className=\"max-w-full max-h-full object-contain rounded-lg\"\r\n                />\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute top-6 right-6 w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors\"\r\n                >\r\n                    ‚úï\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAIe,SAAS,YAAY,EAAE,SAAS,EAAE,OAAO,EAAoB;IACxE,IAAI,CAAC,WAAW,OAAO;IAEvB,qBACI,8PAAC;QACG,WAAU;QACV,SAAS;kBAET,cAAA,8PAAC;YAAI,WAAU;;8BACX,8PAAC;oBACG,KAAK;oBACL,KAAI;oBACJ,WAAU;;;;;;8BAEd,8PAAC;oBACG,SAAS;oBACT,WAAU;8BACb;;;;;;;;;;;;;;;;;AAMjB","debugId":null}},
    {"offset": {"line": 556, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/Chat.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { useSocket } from \"@/contexts/SocketContext\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { sendImage, getImage } from \"@/lib/api\";\r\nimport { Message } from \"@/types/chat\";\r\nimport MessageBubble from \"@/components/chat/MessageBubble\";\r\nimport ImagePreview from \"@/components/chat/ImagePreview\";\r\nimport CameraView from \"@/components/chat/CameraView\";\r\nimport GalleryModal from \"@/components/chat/GalleryModal\";\r\nimport ImageViewer from \"@/components/chat/ImageViewer\";\r\n\r\nexport default function Chat() {\r\n    const messagesEndRef = useRef<HTMLDivElement | null>(null);\r\n    const [photo, setPhoto] = useState<string | null>(null);\r\n    const [cameraOpen, setCameraOpen] = useState(false);\r\n    const [galleryOpen, setGalleryOpen] = useState(false);\r\n    const [message, setMessage] = useState(\"\");\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [selectedImage, setSelectedImage] = useState<string | null>(null);\r\n    const { pseudo } = useAuth();\r\n    const socket = useSocket();\r\n\r\n    const sendMessage = () => {\r\n        if (message.trim() === \"\") return;\r\n        socket.sendMessage(message);\r\n        setMessage(\"\");\r\n    };\r\n\r\n    useEffect(() => {\r\n        setMessages([]);\r\n    }, [socket.currentRoom]);\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    };\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages]);\r\n\r\n    useEffect(() => {\r\n        if (!socket.socket) return;\r\n\r\n        socket.getMessages((data: Message) => {\r\n            if (data.pseudo === \"SERVER\") return;\r\n\r\n            // Nouveau : Donn√©es brutes (simplifi√© par l'utilisateur)\r\n            if (!data.imageData && data.content.startsWith('data:image/')) {\r\n                data.imageData = data.content;\r\n            }\r\n\r\n\r\n            // Si c'est une image, on extrait l'ID\r\n            if (data.imageData) {\r\n                // Pour les messages entrants, on n'a pas forc√©ment l'ID de l'image\r\n                // Il faudrait que le back renvoie l'ID s'il est stock√©\r\n                // Pour l'instant on suppose que le content contient l'URL si c'est un message syst√®me\r\n            } else if (data.content && data.content.includes('/images/')) {\r\n                // Tentative d'extraction d'ID depuis l'URL si pr√©sent dans le content\r\n                const urlMatch = data.content.match(/https?:\\/\\/[^\\s]+\\/images\\/([^\\s]+)/);\r\n                if (urlMatch && urlMatch[1]) {\r\n                    data.imageId = urlMatch[1];\r\n                }\r\n            }\r\n\r\n            setMessages((prev) => [...prev, data]);\r\n        });\r\n    }, [socket]);\r\n\r\n\r\n    const sendPhoto = async () => {\r\n        if (!photo || !socket.socket?.id) return;\r\n\r\n        // 1. Envoyer l'image √† l'API (Syst√®me 1 - Optionnel si souhait√©)\r\n        const result = await sendImage(socket.socket.id, photo);\r\n\r\n        if (result.success) {\r\n            console.log(\"üì∏ Image envoy√©e √† l'API avec succ√®s\");\r\n        } else {\r\n            console.error(\"Erreur lors de l'envoi de l'image √† l'API:\", result.error);\r\n        }\r\n\r\n        // 2. Envoyer le message avec les donn√©es brutes (Nouveau syst√®me simplifi√©)\r\n        socket.sendImageMessage(photo);\r\n        setPhoto(null);\r\n    };\r\n\r\n    const deletePhoto = () => {\r\n        setPhoto(null);\r\n    };\r\n\r\n    const handleCameraButtonClick = () => {\r\n        if (photo) {\r\n            deletePhoto();\r\n        }\r\n        setCameraOpen(true);\r\n    };\r\n\r\n    const handleSendClick = () => {\r\n        if (photo) {\r\n            sendPhoto();\r\n        } else if (message.trim() !== \"\") {\r\n            sendMessage();\r\n        }\r\n    };\r\n\r\n    const handlePhotoTaken = (photoData: string) => {\r\n        setPhoto(photoData);\r\n        setCameraOpen(false);\r\n    };\r\n\r\n    const handleSelectPhoto = (photoData: string) => {\r\n        setPhoto(photoData);\r\n        setGalleryOpen(false);\r\n    };\r\n\r\n    const [showActionsMenu, setShowActionsMenu] = useState(false);\r\n\r\n    // ... (rest of the component logic)\r\n\r\n    return (\r\n        <div className=\"h-[calc(100vh-57px)] w-5/7 flex flex-col items-center justify-end px-12 py-4\" onClick={() => setShowActionsMenu(false)}>\r\n            {socket.currentRoom ? (\r\n                <>\r\n                    <div className=\"w-full flex-1 overflow-y-auto overflow-x-hidden flex flex-col gap-1 mb-4\">\r\n                        {messages.map((msg, index) => (\r\n                            <MessageBubble\r\n                                key={index}\r\n                                message={msg}\r\n                                isOwnMessage={msg.pseudo === pseudo}\r\n                                onImageClick={setSelectedImage}\r\n                            />\r\n                        ))}\r\n                        <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    <div className=\"w-full mb-4\">\r\n                        {photo && (\r\n                            <ImagePreview imageData={photo} onDelete={deletePhoto} />\r\n                        )}\r\n\r\n                        <div className=\"relative flex items-center\" onClick={(e) => e.stopPropagation()}>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={message}\r\n                                onChange={(e) => setMessage(e.target.value)}\r\n                                onKeyDown={(e) => e.key === \"Enter\" && handleSendClick()}\r\n                                placeholder=\"Message ...\"\r\n                                disabled={!!photo}\r\n                                className=\"border rounded-full pl-4 pr-16 py-3 w-full shadow-sm focus:outline-none focus:ring-2 focus:ring-violet-400 disabled:bg-gray-100 disabled:cursor-not-allowed text-gray-700\"\r\n                            />\r\n\r\n                            {/* Bouton d'envoi */}\r\n                            <button\r\n                                onClick={handleSendClick}\r\n                                className=\"absolute right-4 text-violet-600 hover:text-violet-800 transition-colors cursor-pointer p-1\"\r\n                                title=\"Envoyer\"\r\n                            >\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-6 h-6\">\r\n                                    <path d=\"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z\" />\r\n                                </svg>\r\n                            </button>\r\n\r\n                            {/* Bouton Actions (Plus) */}\r\n                            <button\r\n                                onClick={() => setShowActionsMenu(!showActionsMenu)}\r\n                                className={`absolute right-12 text-gray-500 hover:text-violet-600 transition-colors cursor-pointer p-1 rounded-full ${showActionsMenu ? 'bg-gray-100 text-violet-600' : ''}`}\r\n                                title=\"Plus d'actions\"\r\n                            >\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-7 h-7\">\r\n                                    <path fillRule=\"evenodd\" d=\"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z\" clipRule=\"evenodd\" />\r\n                                </svg>\r\n                            </button>\r\n\r\n                            {/* Dropdown Menu */}\r\n                            {showActionsMenu && (\r\n                                <div className=\"absolute right-0 bottom-14 bg-white rounded-lg shadow-xl border border-gray-100 p-2 flex flex-col gap-1 min-w-[200px] z-10 animate-in fade-in slide-in-from-bottom-2 duration-200\">\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            handleCameraButtonClick();\r\n                                            setShowActionsMenu(false);\r\n                                        }}\r\n                                        className=\"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left\"\r\n                                    >\r\n                                        <span className=\"text-xl\">üì∏</span>\r\n                                        <span className=\"font-medium text-sm\">Prendre photo</span>\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            setGalleryOpen(true);\r\n                                            setShowActionsMenu(false);\r\n                                        }}\r\n                                        className=\"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left\"\r\n                                    >\r\n                                        <span className=\"text-xl\">üñºÔ∏è</span>\r\n                                        <span className=\"font-medium text-sm\">Galerie</span>\r\n                                    </button>\r\n                                    <div className=\"h-px bg-gray-100 my-1\"></div>\r\n                                    <button\r\n                                        onClick={async () => {\r\n                                            setShowActionsMenu(false);\r\n                                            try {\r\n                                                if (!navigator.getBattery) {\r\n                                                    alert(\"Cette fonctionnalit√© n'est pas support√©e sur votre appareil (ex: iOS).\");\r\n                                                    return;\r\n                                                }\r\n                                                const battery = await navigator.getBattery();\r\n                                                const level = Math.round(battery.level * 100);\r\n                                                const icon = level > 20 ? 'üîã' : 'ü™´';\r\n                                                const charging = battery.charging ? '‚ö°' : '';\r\n                                                socket.sendMessage(`${icon} J'ai ${level}% de batterie ${charging}`);\r\n                                            } catch (e) {\r\n                                                console.error(e);\r\n                                                alert(\"Impossible d'acc√©der aux infos de batterie\");\r\n                                            }\r\n                                        }}\r\n                                        className=\"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left\"\r\n                                    >\r\n                                        <span className=\"text-xl\">‚ö°</span>\r\n                                        <span className=\"font-medium text-sm\">Partager batterie</span>\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            setShowActionsMenu(false);\r\n                                            if (!navigator.geolocation) {\r\n                                                alert(\"La g√©olocalisation n'est pas support√©e par votre navigateur.\");\r\n                                                return;\r\n                                            }\r\n                                            navigator.geolocation.getCurrentPosition(\r\n                                                (position) => {\r\n                                                    const { latitude, longitude } = position.coords;\r\n                                                    const link = `https://www.google.com/maps?q=${latitude},${longitude}`;\r\n                                                    socket.sendMessage(`üìç Ma position : ${link}`);\r\n                                                },\r\n                                                (error) => {\r\n                                                    console.error(\"Erreur g√©olocalisation:\", error);\r\n                                                    alert(\"Impossible de r√©cup√©rer votre position (autorisation refus√©e ?)\");\r\n                                                }\r\n                                            );\r\n                                        }}\r\n                                        className=\"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left\"\r\n                                    >\r\n                                        <span className=\"text-xl\">üìç</span>\r\n                                        <span className=\"font-medium text-sm\">Partager position</span>\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </>\r\n            ) : (\r\n                <p className=\"text-gray-500\">S√©lectionnez une room pour commencer √† discuter</p>\r\n            )}\r\n\r\n            {cameraOpen && (\r\n                <CameraView onPhotoTaken={handlePhotoTaken} onClose={() => setCameraOpen(false)} />\r\n            )}\r\n\r\n            <GalleryModal\r\n                isOpen={galleryOpen}\r\n                onClose={() => setGalleryOpen(false)}\r\n                onSelectPhoto={handleSelectPhoto}\r\n            />\r\n\r\n            <ImageViewer imageData={selectedImage} onClose={() => setSelectedImage(null)} />\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1004, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/components/Sidebar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { fetchData } from \"@/lib/api\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useSocket } from \"@/contexts/SocketContext\";\r\n\r\nexport default function Sidebar() {\r\n    const [rooms, setRooms] = useState<string[]>([]);\r\n    const [newRoomName, setNewRoomName] = useState(\"\");\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n    const { pseudo } = useAuth();\r\n    const socket = useSocket();\r\n    const [openModal, setOpenModal] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const fetchRooms = async () => {\r\n            const data = await fetchData(\"/rooms\");\r\n            if (data?.data) setRooms(Object.keys(data.data));\r\n        };\r\n        fetchRooms();\r\n    }, []);\r\n\r\n    const handleJoinRoom = (roomName: string) => {\r\n        if (!socket) return;\r\n        socket.joinRoom(roomName, pseudo);\r\n    };\r\n\r\n    const handleCreateRoom = async () => {\r\n        if (newRoomName.trim() === \"\") return;\r\n        handleJoinRoom(encodeURIComponent(newRoomName.trim()));\r\n        setNewRoomName(\"\");\r\n        setOpenModal(false);\r\n    };\r\n\r\n    const filteredRooms = rooms.filter(room =>\r\n        decodeURIComponent(room).toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <div className=\"h-[calc(100vh-57px)] w-2/7 flex flex-col p-4 border-r border-gray-300 bg-gray-50\">\r\n                <div className=\"mb-4 flex flex-col gap-3\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                        <h1 className=\"text-xl font-semibold\">Conversations</h1>\r\n                        <button onClick={() => setOpenModal(true)} className=\"w-[32px] h-[32px] aspect-square bg-violet-600 text-white rounded-full cursor-pointer text-xl flex items-center justify-center hover:bg-violet-700 transition-colors shadow-sm\">\r\n                            +\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Rechercher...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full px-4 py-2 pl-9 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-violet-400 bg-white shadow-sm transition-all\"\r\n                        />\r\n                        <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\">\r\n                            üîç\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"overflow-y-auto flex flex-col gap-2 flex-1\">\r\n                    {filteredRooms.length > 0 ? (\r\n                        filteredRooms.map((room) => (\r\n                            <div\r\n                                key={room}\r\n                                onClick={() => handleJoinRoom(room)}\r\n                                className={`w-full bg-white border-l-4 ${room === socket?.currentRoom ? \"border-violet-600 bg-violet-50\" : \"border-transparent\"\r\n                                    } hover:border-violet-600 hover:bg-violet-50 transition-all cursor-pointer p-4 rounded-r-lg shadow-sm flex justify-between items-center`}\r\n                            >\r\n                                <p className=\"truncate font-medium text-[15px] text-gray-700\">\r\n                                    {decodeURIComponent(room)}\r\n                                </p>\r\n                            </div>\r\n                        ))\r\n                    ) : (\r\n                        <div className=\"text-center text-gray-400 mt-4 text-sm\">\r\n                            Aucune conversation trouv√©e\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {openModal && (\r\n                <div className=\"w-screen h-screen overflow-hidden absolute top-0 left-0 z-20\">\r\n                    <div className=\"w-full h-full bg-black opacity-70 flex justify-center items-center\" onClick={() => setOpenModal(false)}>\r\n\r\n                    </div>\r\n                    <div className=\"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-6 py-4 rounded-lg flex flex-col items-start gap-4\">\r\n                        <h2 className=\"text-xl font-semibold\">Cr√©er une nouvelle conversation</h2>\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"w-full border-1 border-black p-1 rounded-md\"\r\n                            value={newRoomName}\r\n                            onChange={(e) => setNewRoomName(e.target.value)}\r\n                            onKeyDown={(e) => e.key === \"Enter\" && handleCreateRoom()}\r\n                            placeholder=\"Nom de la conversation\"\r\n                        />\r\n                        <button onClick={handleCreateRoom} className=\"bg-violet-600 px-4 py-1 cursor-pointer rounded-md text-white\">Cr√©er</button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACpB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iOAAQ,EAAW,EAAE;IAC/C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iOAAQ,EAAC;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iOAAQ,EAAC;IAC7C,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,mJAAO;IAC1B,MAAM,SAAS,IAAA,uJAAS;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iOAAQ,EAAC;IAE3C,IAAA,kOAAS,EAAC;QACN,MAAM,aAAa;YACf,MAAM,OAAO,MAAM,IAAA,uIAAS,EAAC;YAC7B,IAAI,MAAM,MAAM,SAAS,OAAO,IAAI,CAAC,KAAK,IAAI;QAClD;QACA;IACJ,GAAG,EAAE;IAEL,MAAM,iBAAiB,CAAC;QACpB,IAAI,CAAC,QAAQ;QACb,OAAO,QAAQ,CAAC,UAAU;IAC9B;IAEA,MAAM,mBAAmB;QACrB,IAAI,YAAY,IAAI,OAAO,IAAI;QAC/B,eAAe,mBAAmB,YAAY,IAAI;QAClD,eAAe;QACf,aAAa;IACjB;IAEA,MAAM,gBAAgB,MAAM,MAAM,CAAC,CAAA,OAC/B,mBAAmB,MAAM,WAAW,GAAG,QAAQ,CAAC,WAAW,WAAW;IAG1E,qBACI;;0BACI,8PAAC;gBAAI,WAAU;;kCACX,8PAAC;wBAAI,WAAU;;0CACX,8PAAC;gCAAI,WAAU;;kDACX,8PAAC;wCAAG,WAAU;kDAAwB;;;;;;kDACtC,8PAAC;wCAAO,SAAS,IAAM,aAAa;wCAAO,WAAU;kDAAgL;;;;;;;;;;;;0CAIzO,8PAAC;gCAAI,WAAU;;kDACX,8PAAC;wCACG,MAAK;wCACL,aAAY;wCACZ,OAAO;wCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;wCAC7C,WAAU;;;;;;kDAEd,8PAAC;wCAAK,WAAU;kDAAmE;;;;;;;;;;;;;;;;;;kCAK3F,8PAAC;wBAAI,WAAU;kCACV,cAAc,MAAM,GAAG,IACpB,cAAc,GAAG,CAAC,CAAC,qBACf,8PAAC;gCAEG,SAAS,IAAM,eAAe;gCAC9B,WAAW,CAAC,2BAA2B,EAAE,SAAS,QAAQ,cAAc,mCAAmC,qBACtG,sIAAsI,CAAC;0CAE5I,cAAA,8PAAC;oCAAE,WAAU;8CACR,mBAAmB;;;;;;+BANnB;;;;sDAWb,8PAAC;4BAAI,WAAU;sCAAyC;;;;;;;;;;;;;;;;;YAOnE,2BACG,8PAAC;gBAAI,WAAU;;kCACX,8PAAC;wBAAI,WAAU;wBAAqE,SAAS,IAAM,aAAa;;;;;;kCAGhH,8PAAC;wBAAI,WAAU;;0CACX,8PAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,8PAAC;gCACG,MAAK;gCACL,WAAU;gCACV,OAAO;gCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;gCAC9C,WAAW,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW;gCACvC,aAAY;;;;;;0CAEhB,8PAAC;gCAAO,SAAS;gCAAkB,WAAU;0CAA+D;;;;;;;;;;;;;;;;;;;;AAMpI","debugId":null}}]
}