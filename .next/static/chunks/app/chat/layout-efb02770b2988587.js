(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{4084:(e,t,o)=>{Promise.resolve().then(o.bind(o,9262))},9262:(e,t,o)=>{"use strict";o.d(t,{F:()=>s,SocketProvider:()=>c});var n=o(5155),r=o(2115),a=o(9829);let i=(0,r.createContext)(null),c=e=>{let{children:t}=e,[o,c]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),[u,m]=(0,r.useState)("undefined"==typeof navigator||navigator.onLine),f=(0,r.useRef)(void 0),d=(0,r.useRef)(void 0);(0,r.useEffect)(()=>{let e=()=>m(!0),t=()=>m(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let g=(e,t)=>{let o=JSON.parse(localStorage.getItem("offline_queue")||"[]");if(0===o.length)return;let n=t||s;if(!n)return;console.log("\uD83C\uDF10 Traitement file d'attente pour la room : ".concat(n));let r=o.filter(e=>e.roomName===n),a=o.filter(e=>e.roomName!==n);0!==r.length&&(console.log("\uD83D\uDE80 Envoi de ".concat(r.length," messages pour ").concat(n,"...")),r.forEach(t=>{e.emit("chat-msg",{content:t.content,roomName:t.roomName}),t.tempId&&d.current&&d.current(t.tempId)}),localStorage.setItem("offline_queue",JSON.stringify(a)))};(0,r.useEffect)(()=>{let e=(0,a.io)("https://api.tools.gavago.fr",{transports:["websocket"],autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0});return e.on("connect",()=>{console.log("\uD83D\uDFE2 Connect\xe9 au serveur Socket.IO"),setTimeout(()=>{s&&g(e,s)},500)}),e.on("disconnect",e=>{console.log("\uD83D\uDD34 D\xe9connect\xe9 du serveur Socket.IO",e)}),e.on("connect_error",e=>{console.log("⚠️ Erreur de connexion Socket.IO",e)}),c(e),()=>{e.disconnect()}},[]);let v=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n="temp_".concat(Date.now(),"_").concat(Math.random()),r=JSON.parse(localStorage.getItem("offline_queue")||"[]");r.push({content:e,roomName:t,timestamp:Date.now(),tempId:n,isImage:o}),localStorage.setItem("offline_queue",JSON.stringify(r)),f.current&&f.current({content:e,pseudo:null,pending:!0,tempId:n,imageData:o?e:void 0,dateEmis:new Date().toISOString()})};return(0,n.jsx)(i.Provider,{value:{socket:o,currentRoom:s,joinRoom:(e,t)=>{o&&s!==e&&(o.off("chat-join-room"),l(null),o.emit("chat-join-room",{pseudo:t,roomName:e}),l(e),o.connected&&(console.log("Variante joinRoom : V\xe9rification messages en attente..."),g(o,e)))},sendMessage:e=>{if(s){if(!u)return void v(e,s);o&&o.connected?o.timeout(5e3).emit("chat-msg",{content:e,roomName:s},t=>{t&&v(e,s)}):v(e,s)}},sendImageMessage:e=>{if(s){if(!u)return void v(e,s,!0);o&&o.connected?o.timeout(5e3).emit("chat-msg",{content:e,roomName:s},t=>{t&&v(e,s,!0)}):v(e,s,!0)}},getMessages:e=>{o&&(o.off("chat-msg"),o.on("chat-msg",t=>{e(t)}))},setPendingMessageCallback:e=>{f.current=e},setMessageSentCallback:e=>{d.current=e}},children:t})},s=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useSocket must be used within a SocketProvider");return e}}},e=>{e.O(0,[829,441,255,358],()=>e(e.s=4084)),_N_E=e.O()}]);