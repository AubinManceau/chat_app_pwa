(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{59:(e,t,s)=>{Promise.resolve().then(s.bind(s,6518)),Promise.resolve().then(s.bind(s,6710))},6518:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var a=s(5155),r=s(2115),o=s(9262),l=s(9293),n=s(7621);function i(e){var t;let{message:s,isOwnMessage:o,onImageClick:l}=e,[i,c]=(0,r.useState)(s.imageData||null),[d,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s.imageData&&c(s.imageData)},[s.imageData]),(0,r.useEffect)(()=>{!s.imageId||i||d||(async()=>{u(!0);let e=await (0,n.Qp)(s.imageId);e.success&&e.data_image&&c(e.data_image),u(!1)})()},[s.imageId,i]);let m=new Date(null!=(t=s.dateEmis)?t:Date.now()),x=new Date,g=m.getDate()===x.getDate()&&m.getMonth()===x.getMonth()&&m.getFullYear()===x.getFullYear(),h=e=>e.toString().padStart(2,"0"),f=h(m.getHours()),p=h(m.getMinutes()),v=g?"".concat(f,":").concat(p):"".concat(h(m.getDate()),"/").concat(h(m.getMonth()+1),"/").concat(m.getFullYear()," - ").concat(f,":").concat(p),j=i||s.imageId;return(0,a.jsx)("div",{className:"w-full flex ".concat(o?"justify-end":"justify-start"," items-center mb-2"),children:(0,a.jsxs)("div",{className:"flex flex-col gap-1.5 px-3 py-1 rounded-lg w-fit max-w-[70%] ".concat(o?"bg-violet-600 text-white":"bg-gray-200 text-gray-800"),children:[(0,a.jsxs)("p",{className:"text-[12px] break-words",children:[s.pseudo||s.userId||"Anonyme"," ",(0,a.jsx)("span",{className:"text-[10px] italic ".concat(o?"text-white":"text-gray-500"),children:v})]}),j?(0,a.jsx)("div",{className:"cursor-pointer rounded overflow-hidden relative min-h-[50px] min-w-[50px] flex items-center justify-center bg-black/5",onClick:()=>i&&l(i),children:i?(0,a.jsx)("img",{src:i,alt:"Image partag\xe9e",className:"max-w-full h-auto rounded",style:{maxHeight:"200px"}}):(0,a.jsxs)("div",{className:"p-4 flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{className:"text-xs opacity-70",children:"Chargement..."})]})}):(0,a.jsx)("p",{className:"break-words",children:s.content.split(/(https?:\/\/[^\s]+)/g).map((e,t)=>e.match(/https?:\/\/[^\s]+/)?(0,a.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"underline cursor-pointer hover:opacity-80 break-all ".concat(o?"text-white":"text-blue-600"),children:e},t):e)})]})})}function c(e){let{imageData:t,onDelete:s}=e;return(0,a.jsxs)("div",{className:"mb-2 relative flex justify-end",children:[(0,a.jsx)("img",{src:t,alt:"Pr\xe9visualisation",className:"rounded-lg shadow-lg max-h-40 object-contain"}),(0,a.jsx)("button",{onClick:s,className:"absolute -top-2 -right-2 w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors",children:"✕"})]})}function d(e){let{onPhotoTaken:t,onClose:s}=e,o=(0,r.useRef)(null),l=(0,r.useRef)(null),[n,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=!0,t=null;return async function(){try{let s=await navigator.mediaDevices.getUserMedia({video:!0});if(!e)return void s.getTracks().forEach(e=>e.stop());t=s,o.current&&(o.current.srcObject=s),i(s)}catch(e){}}(),()=>{e=!1,t&&t.getTracks().forEach(e=>e.stop()),n&&n.getTracks().forEach(e=>e.stop())}},[]),(0,a.jsxs)("div",{className:"fixed inset-0 w-full h-full bg-white z-50",children:[(0,a.jsx)("canvas",{ref:l,style:{display:"none"}}),(0,a.jsx)("video",{ref:o,autoPlay:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover scale-x-[-1]"}),(0,a.jsxs)("div",{className:"absolute bottom-8 w-full flex justify-center gap-8",children:[(0,a.jsx)("button",{onClick:()=>{if(!o.current||!l.current)return;let e=o.current,s=l.current;s.width=e.videoWidth,s.height=e.videoHeight;let a=s.getContext("2d");if(!a)return;a.translate(s.width,0),a.scale(-1,1),a.drawImage(e,0,0,s.width,s.height);let r=s.toDataURL("image/jpeg",.7),n=JSON.parse(localStorage.getItem("photos")||"[]");n.push(r),localStorage.setItem("photos",JSON.stringify(n)),t(r)},className:"w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-lg border-4 border-gray-300",children:"\uD83D\uDCF8"}),(0,a.jsx)("button",{onClick:()=>{n&&n.getTracks().forEach(e=>e.stop()),s()},className:"w-16 h-16 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg",children:"X"})]})]})}function u(e){let{isOpen:t,onClose:s,onSelectPhoto:o}=e,[l,n]=(0,r.useState)([]);return((0,r.useEffect)(()=>{t&&n(JSON.parse(localStorage.getItem("photos")||"[]").reverse())},[t]),t)?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:s,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Galerie"}),(0,a.jsx)("button",{onClick:s,className:"w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors",children:"✕"})]}),0===l.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Aucune photo dans la galerie"}):(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:l.map((e,t)=>(0,a.jsx)("div",{className:"relative cursor-pointer group",onClick:()=>o(e),children:(0,a.jsx)("img",{src:e,alt:"Photo ".concat(t+1),className:"w-full h-32 object-cover rounded-lg shadow-md group-hover:shadow-xl transition-shadow"})},t))})]})}):null}var m=s(6976);function x(){let e=(0,r.useRef)(null),[t,s]=(0,r.useState)(null),[x,g]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),[p,v]=(0,r.useState)(""),[j,b]=(0,r.useState)([]),[w,y]=(0,r.useState)(null),{pseudo:N}=(0,l.A)(),C=(0,o.F)();(0,r.useEffect)(()=>{b([])},[C.currentRoom]),(0,r.useEffect)(()=>{var t;null==(t=e.current)||t.scrollIntoView({behavior:"smooth"})},[j]),(0,r.useEffect)(()=>{C.socket&&C.getMessages(e=>{if("SERVER"!==e.pseudo){if(!e.imageData&&e.content.startsWith("data:image/")&&(e.imageData=e.content),e.imageData);else if(e.content&&e.content.includes("/images/")){let t=e.content.match(/https?:\/\/[^\s]+\/images\/([^\s]+)/);t&&t[1]&&(e.imageId=t[1])}b(t=>[...t,e])}})},[C]);let k=async()=>{var e;if(!t||!(null==(e=C.socket)?void 0:e.id))return;let a=await (0,n.gj)(C.socket.id,t);a.success?console.log("\uD83D\uDCF8 Image envoy\xe9e \xe0 l'API avec succ\xe8s"):console.error("Erreur lors de l'envoi de l'image \xe0 l'API:",a.error),C.sendImageMessage(t),s(null)},S=()=>{s(null)},D=()=>{t?k():""!==p.trim()&&""!==p.trim()&&(C.sendMessage(p),v(""))},[E,I]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"h-[calc(100vh-57px)] w-5/7 flex flex-col items-center justify-end px-12 py-4",onClick:()=>I(!1),children:[C.currentRoom?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full flex-1 overflow-y-auto overflow-x-hidden flex flex-col gap-1 mb-4",children:[j.map((e,t)=>(0,a.jsx)(i,{message:e,isOwnMessage:e.pseudo===N,onImageClick:y},t)),(0,a.jsx)("div",{ref:e})]}),(0,a.jsxs)("div",{className:"w-full mb-4",children:[t&&(0,a.jsx)(c,{imageData:t,onDelete:S}),(0,a.jsxs)("div",{className:"relative flex items-center",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("input",{type:"text",value:p,onChange:e=>v(e.target.value),onKeyDown:e=>"Enter"===e.key&&D(),placeholder:"Message ...",disabled:!!t,className:"border rounded-full pl-4 pr-16 py-3 w-full shadow-sm focus:outline-none focus:ring-2 focus:ring-violet-400 disabled:bg-gray-100 disabled:cursor-not-allowed text-gray-700"}),(0,a.jsx)("button",{onClick:D,className:"absolute right-4 text-violet-600 hover:text-violet-800 transition-colors cursor-pointer p-1",title:"Envoyer",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:(0,a.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})}),(0,a.jsx)("button",{onClick:()=>I(!E),className:"absolute right-12 text-gray-500 hover:text-violet-600 transition-colors cursor-pointer p-1 rounded-full ".concat(E?"bg-gray-100 text-violet-600":""),title:"Plus d'actions",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z",clipRule:"evenodd"})})}),E&&(0,a.jsxs)("div",{className:"absolute right-0 bottom-14 bg-white rounded-lg shadow-xl border border-gray-100 p-2 flex flex-col gap-1 min-w-[200px] z-10 animate-in fade-in slide-in-from-bottom-2 duration-200",children:[(0,a.jsxs)("button",{onClick:()=>{t&&S(),g(!0),I(!1)},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDCF8"}),(0,a.jsx)("span",{className:"font-medium text-sm",children:"Prendre photo"})]}),(0,a.jsxs)("button",{onClick:()=>{f(!0),I(!1)},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDDBC️"}),(0,a.jsx)("span",{className:"font-medium text-sm",children:"Galerie"})]}),(0,a.jsx)("div",{className:"h-px bg-gray-100 my-1"}),(0,a.jsxs)("button",{onClick:async()=>{I(!1);try{if(!navigator.getBattery)return void alert("Cette fonctionnalit\xe9 n'est pas support\xe9e sur votre appareil (ex: iOS).");let e=await navigator.getBattery(),t=Math.round(100*e.level),s=t>20?"\uD83D\uDD0B":"\uD83E\uDEAB",a=e.charging?"⚡":"";C.sendMessage("".concat(s," J'ai ").concat(t,"% de batterie ").concat(a))}catch(e){console.error(e),alert("Impossible d'acc\xe9der aux infos de batterie")}},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,a.jsx)("span",{className:"text-xl",children:"⚡"}),(0,a.jsx)("span",{className:"font-medium text-sm",children:"Partager batterie"})]}),(0,a.jsxs)("button",{onClick:()=>{if(I(!1),!navigator.geolocation)return void alert("La g\xe9olocalisation n'est pas support\xe9e par votre navigateur.");navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:s}=e.coords,a="https://www.google.com/maps?q=".concat(t,",").concat(s);C.sendMessage("\uD83D\uDCCD Ma position : ".concat(a))},e=>{console.error("Erreur g\xe9olocalisation:",e),alert("Impossible de r\xe9cup\xe9rer votre position (autorisation refus\xe9e ?)")})},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCD"}),(0,a.jsx)("span",{className:"font-medium text-sm",children:"Partager position"})]})]})]})]})]}):(0,a.jsx)("p",{className:"text-gray-500",children:"S\xe9lectionnez une room pour commencer \xe0 discuter"}),x&&(0,a.jsx)(d,{onPhotoTaken:e=>{s(e),g(!1)},onClose:()=>g(!1)}),(0,a.jsx)(u,{isOpen:h,onClose:()=>f(!1),onSelectPhoto:e=>{s(e),f(!1)}}),(0,a.jsx)(m.A,{imageData:w,onClose:()=>y(null)})]})}},6710:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var a=s(5155),r=s(2115),o=s(7621),l=s(9293),n=s(9262);function i(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),{pseudo:u}=(0,l.A)(),m=(0,n.F)(),[x,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{let e=await (0,o.Fd)("/rooms");(null==e?void 0:e.data)&&t(Object.keys(e.data))})()},[]);let h=e=>{m&&m.joinRoom(e,u)},f=async()=>{""!==s.trim()&&(h(encodeURIComponent(s.trim())),i(""),g(!1))},p=e.filter(e=>decodeURIComponent(e).toLowerCase().includes(c.toLowerCase()));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"h-[calc(100vh-57px)] w-2/7 flex flex-col p-4 border-r border-gray-300 bg-gray-50",children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Conversations"}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"w-[32px] h-[32px] aspect-square bg-violet-600 text-white rounded-full cursor-pointer text-xl flex items-center justify-center hover:bg-violet-700 transition-colors shadow-sm",children:"+"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Rechercher...",value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 pl-9 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-violet-400 bg-white shadow-sm transition-all"}),(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\uD83D\uDD0D"})]})]}),(0,a.jsx)("div",{className:"overflow-y-auto flex flex-col gap-2 flex-1",children:p.length>0?p.map(e=>(0,a.jsx)("div",{onClick:()=>h(e),className:"w-full bg-white border-l-4 ".concat(e===(null==m?void 0:m.currentRoom)?"border-violet-600 bg-violet-50":"border-transparent"," hover:border-violet-600 hover:bg-violet-50 transition-all cursor-pointer p-4 rounded-r-lg shadow-sm flex justify-between items-center"),children:(0,a.jsx)("p",{className:"truncate font-medium text-[15px] text-gray-700",children:decodeURIComponent(e)})},e)):(0,a.jsx)("div",{className:"text-center text-gray-400 mt-4 text-sm",children:"Aucune conversation trouv\xe9e"})})]}),x&&(0,a.jsxs)("div",{className:"w-screen h-screen overflow-hidden absolute top-0 left-0 z-20",children:[(0,a.jsx)("div",{className:"w-full h-full bg-black opacity-70 flex justify-center items-center",onClick:()=>g(!1)}),(0,a.jsxs)("div",{className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-6 py-4 rounded-lg flex flex-col items-start gap-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Cr\xe9er une nouvelle conversation"}),(0,a.jsx)("input",{type:"text",className:"w-full border-1 border-black p-1 rounded-md",value:s,onChange:e=>i(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"Nom de la conversation"}),(0,a.jsx)("button",{onClick:f,className:"bg-violet-600 px-4 py-1 cursor-pointer rounded-md text-white",children:"Cr\xe9er"})]})]})]})}},6976:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155);function r(e){let{imageData:t,onClose:s}=e;return t?(0,a.jsx)("div",{className:"bg-black/70 fixed inset-0 flex items-center justify-center z-50",onClick:s,children:(0,a.jsxs)("div",{className:"relative max-w-4xl max-h-[90vh] p-4",children:[(0,a.jsx)("img",{src:t,alt:"Image agrandie",className:"max-w-full max-h-full object-contain rounded-lg"}),(0,a.jsx)("button",{onClick:s,className:"absolute top-6 right-6 w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors",children:"✕"})]})}):null}},7621:(e,t,s)=>{"use strict";async function a(e){try{let t="".concat("https://api.tools.gavago.fr/socketio/api").concat(e),s=await fetch(t,{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!s.ok)throw Error("Erreur HTTP! Statut: ".concat(s.status));return await s.json()}catch(e){return{error:e.message}}}async function r(e,t){try{let s=await fetch("/api/images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,image_data:t})});if(!s.ok)throw Error("Erreur HTTP! Statut: ".concat(s.status));return await s.json()}catch(e){return{error:e.message}}}async function o(e){try{let t=await fetch("/api/images?id=".concat(e),{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok)throw Error("Erreur HTTP! Statut: ".concat(t.status));return await t.json()}catch(e){return{error:e.message}}}s.d(t,{Fd:()=>a,Qp:()=>o,gj:()=>r})},9262:(e,t,s)=>{"use strict";s.d(t,{F:()=>i,SocketProvider:()=>n});var a=s(5155),r=s(2115),o=s(9829);let l=(0,r.createContext)(null),n=e=>{let{children:t}=e,[s,n]=(0,r.useState)(null),[i,c]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,o.io)("https://api.tools.gavago.fr",{transports:["websocket"],autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0});return e.on("connect",()=>{console.log("\uD83D\uDFE2 Connect\xe9 au serveur Socket.IO")}),e.on("disconnect",e=>{console.log("\uD83D\uDD34 D\xe9connect\xe9 du serveur Socket.IO",e)}),e.on("connect_error",e=>{console.log("⚠️ Erreur de connexion Socket.IO",e)}),n(e),()=>{e.disconnect()}},[]),(0,a.jsx)(l.Provider,{value:{socket:s,currentRoom:i,joinRoom:(e,t)=>{s&&i!==e&&(s.off("chat-join-room"),c(null),s.emit("chat-join-room",{pseudo:t,roomName:e}),c(e))},sendMessage:e=>{i&&s&&s.emit("chat-msg",{content:e,roomName:i})},sendImageMessage:e=>{i&&s&&s.emit("chat-msg",{content:e,roomName:i})},getMessages:e=>{s&&(s.off("chat-msg"),s.on("chat-msg",t=>{e(t)}))}},children:t})},i=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useSocket must be used within a SocketProvider");return e}},9293:(e,t,s)=>{"use strict";s.d(t,{A:()=>n,AuthProvider:()=>l});var a=s(5155),r=s(2115);let o=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[s,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{l(localStorage.getItem("pseudo"))},[]),(0,a.jsx)(o.Provider,{value:{pseudo:s,setPseudo:l,clearUser:()=>{localStorage.removeItem("pseudo"),l(null)},registerUser:e=>{localStorage.setItem("pseudo",e),l(e)}},children:t})}function n(){return(0,r.useContext)(o)}}},e=>{e.O(0,[829,441,255,358],()=>e(e.s=59)),_N_E=e.O()}]);