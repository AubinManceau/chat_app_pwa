(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{59:(e,t,a)=>{Promise.resolve().then(a.bind(a,6518)),Promise.resolve().then(a.bind(a,6710))},6518:(e,t,a)=>{"use strict";a.d(t,{default:()=>g});var s=a(5155),o=a(2115),r=a(9262),n=a(9293),l=a(7621);function i(e){var t;let{message:a,isOwnMessage:r,onImageClick:n}=e,[i,c]=(0,o.useState)(a.imageData||null),[d,u]=(0,o.useState)(!1);(0,o.useEffect)(()=>{a.imageData&&c(a.imageData)},[a.imageData]),(0,o.useEffect)(()=>{!a.imageId||i||d||(async()=>{u(!0);let e=await (0,l.Qp)(a.imageId);e.success&&e.data_image&&c(e.data_image),u(!1)})()},[a.imageId,i]);let m=new Date(null!=(t=a.dateEmis)?t:Date.now()),g=new Date,h=m.getDate()===g.getDate()&&m.getMonth()===g.getMonth()&&m.getFullYear()===g.getFullYear(),x=e=>e.toString().padStart(2,"0"),f=x(m.getHours()),p=x(m.getMinutes()),v=h?"".concat(f,":").concat(p):"".concat(x(m.getDate()),"/").concat(x(m.getMonth()+1),"/").concat(m.getFullYear()," - ").concat(f,":").concat(p),b=i||a.imageId;return(0,s.jsx)("div",{className:"w-full flex ".concat(r?"justify-end":"justify-start"," items-center mb-2"),children:(0,s.jsxs)("div",{className:"flex flex-col gap-1.5 px-3 py-1 rounded-lg w-fit max-w-[70%] ".concat(a.pending?r?"bg-violet-300 text-white opacity-70 border-2 border-dashed border-violet-400":"bg-gray-300 text-gray-700 opacity-70 border-2 border-dashed border-gray-400":r?"bg-violet-600 text-white":"bg-gray-200 text-gray-800"),children:[(0,s.jsxs)("p",{className:"text-[12px] break-words",children:[a.pending?(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"\uD83D\uDD04"}),(0,s.jsx)("span",{children:"En attente d'envoi"})]}):(0,s.jsx)(s.Fragment,{children:a.pseudo||a.userId||"Anonyme"})," ",(0,s.jsx)("span",{className:"text-[10px] italic ".concat(r?"text-white":"text-gray-500"),children:v})]}),b?(0,s.jsx)("div",{className:"cursor-pointer rounded overflow-hidden relative min-h-[50px] min-w-[50px] flex items-center justify-center bg-black/5",onClick:()=>i&&n(i),children:i?(0,s.jsx)("img",{src:i,alt:"Image partag\xe9e",className:"max-w-full h-auto rounded",style:{maxHeight:"200px"}}):(0,s.jsxs)("div",{className:"p-4 flex flex-col items-center gap-2",children:[(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{className:"text-xs opacity-70",children:"Chargement..."})]})}):(0,s.jsx)("p",{className:"break-words",children:a.content.split(/(https?:\/\/[^\s]+)/g).map((e,t)=>e.match(/https?:\/\/[^\s]+/)?(0,s.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"underline cursor-pointer hover:opacity-80 break-all ".concat(r?"text-white":"text-blue-600"),children:e},t):e)})]})})}function c(e){let{imageData:t,onDelete:a}=e;return(0,s.jsxs)("div",{className:"mb-2 relative flex justify-end",children:[(0,s.jsx)("img",{src:t,alt:"Pr\xe9visualisation",className:"rounded-lg shadow-lg max-h-40 object-contain"}),(0,s.jsx)("button",{onClick:a,className:"absolute -top-2 -right-2 w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors",children:"✕"})]})}function d(e){let{onPhotoTaken:t,onClose:a}=e,r=(0,o.useRef)(null),n=(0,o.useRef)(null),[l,i]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let e=!0,t=null;return async function(){try{let a=await navigator.mediaDevices.getUserMedia({video:!0});if(!e)return void a.getTracks().forEach(e=>e.stop());t=a,r.current&&(r.current.srcObject=a),i(a)}catch(e){}}(),()=>{e=!1,t&&t.getTracks().forEach(e=>e.stop()),l&&l.getTracks().forEach(e=>e.stop())}},[]),(0,s.jsxs)("div",{className:"fixed inset-0 w-full h-full bg-white z-50",children:[(0,s.jsx)("canvas",{ref:n,style:{display:"none"}}),(0,s.jsx)("video",{ref:r,autoPlay:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover scale-x-[-1]"}),(0,s.jsxs)("div",{className:"absolute bottom-8 w-full flex justify-center gap-8",children:[(0,s.jsx)("button",{onClick:()=>{if(!r.current||!n.current)return;let e=r.current,a=n.current;a.width=e.videoWidth,a.height=e.videoHeight;let s=a.getContext("2d");if(!s)return;s.translate(a.width,0),s.scale(-1,1),s.drawImage(e,0,0,a.width,a.height);let o=a.toDataURL("image/jpeg",.7),l=JSON.parse(localStorage.getItem("photos")||"[]");l.push(o),localStorage.setItem("photos",JSON.stringify(l)),t(o)},className:"w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-lg border-4 border-gray-300",children:"\uD83D\uDCF8"}),(0,s.jsx)("button",{onClick:()=>{l&&l.getTracks().forEach(e=>e.stop()),a()},className:"w-16 h-16 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg",children:"X"})]})]})}function u(e){let{isOpen:t,onClose:a,onSelectPhoto:r}=e,[n,l]=(0,o.useState)([]);return((0,o.useEffect)(()=>{t&&l(JSON.parse(localStorage.getItem("photos")||"[]").reverse())},[t]),t)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:a,children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Galerie"}),(0,s.jsx)("button",{onClick:a,className:"w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors",children:"✕"})]}),0===n.length?(0,s.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Aucune photo dans la galerie"}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:n.map((e,t)=>(0,s.jsx)("div",{className:"relative cursor-pointer group",onClick:()=>r(e),children:(0,s.jsx)("img",{src:e,alt:"Photo ".concat(t+1),className:"w-full h-32 object-cover rounded-lg shadow-md group-hover:shadow-xl transition-shadow"})},t))})]})}):null}var m=a(6976);function g(){let e=(0,o.useRef)(null),[t,a]=(0,o.useState)(null),[g,h]=(0,o.useState)(!1),[x,f]=(0,o.useState)(!1),[p,v]=(0,o.useState)(""),[b,w]=(0,o.useState)([]),[j,y]=(0,o.useState)(null),{pseudo:N}=(0,n.A)(),C=(0,r.F)();(0,o.useEffect)(()=>{w([]);let e=JSON.parse(localStorage.getItem("offline_queue")||"[]").filter(e=>e.roomName===C.currentRoom).map(e=>({content:e.content,pseudo:null,pending:!0,tempId:e.tempId,imageData:e.content.startsWith("data:image/")?e.content:void 0,dateEmis:new Date(e.timestamp||Date.now()).toISOString()}));e.length>0&&w(e)},[C.currentRoom]),(0,o.useEffect)(()=>{var t;null==(t=e.current)||t.scrollIntoView({behavior:"smooth"})},[b]),(0,o.useEffect)(()=>{C.socket&&C.getMessages(e=>{if("SERVER"!==e.pseudo){!e.imageData&&e.content.startsWith("data:image/")&&(e.imageData=e.content);try{let t=JSON.parse(e.content);"image"===t.type&&t.imageData&&(e.imageData=t.imageData,e.imageId=t.imageId)}catch(e){}if(!e.imageData&&e.content.startsWith("IMAGE:data:image/")&&(e.imageData=e.content.substring(6)),!e.imageData&&e.content.startsWith("[IMAGE]")){let t=e.content.match(/https?:\/\/[^\s]+\/images\/([^\s]+)/);t&&t[1]&&(e.imageId=t[1])}w(t=>[...t,e])}})},[C]),(0,o.useEffect)(()=>{C.setPendingMessageCallback&&C.setMessageSentCallback&&(C.setPendingMessageCallback(e=>{w(t=>[...t,e])}),C.setMessageSentCallback(e=>{w(t=>t.filter(t=>t.tempId!==e))}))},[C]);let D=async()=>{var e;if(!t||!(null==(e=C.socket)?void 0:e.id))return;let s=await (0,l.gj)(C.socket.id,t);s.success?console.log("\uD83D\uDCF8 Image envoy\xe9e \xe0 l'API avec succ\xe8s"):console.error("Erreur lors de l'envoi de l'image \xe0 l'API:",s.error),C.sendImageMessage(t),a(null)},k=()=>{a(null)},S=()=>{t?D():""!==p.trim()&&""!==p.trim()&&(C.sendMessage(p),v(""))},[E,I]=(0,o.useState)(!1);return(0,s.jsxs)("div",{className:"h-[calc(100vh-57px)] w-5/7 flex flex-col items-center justify-end px-12 py-4",onClick:()=>I(!1),children:[C.currentRoom?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-full flex-1 overflow-y-auto overflow-x-hidden flex flex-col gap-1 mb-4",children:[b.map((e,t)=>(0,s.jsx)(i,{message:e,isOwnMessage:e.pseudo===N||!0===e.pending,onImageClick:y},t)),(0,s.jsx)("div",{ref:e})]}),(0,s.jsxs)("div",{className:"w-full mb-4",children:[t&&(0,s.jsx)(c,{imageData:t,onDelete:k}),(0,s.jsxs)("div",{className:"relative flex items-center",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("input",{type:"text",value:p,onChange:e=>v(e.target.value),onKeyDown:e=>"Enter"===e.key&&S(),placeholder:"Message ...",disabled:!!t,className:"border rounded-full pl-4 pr-16 py-3 w-full shadow-sm focus:outline-none focus:ring-2 focus:ring-violet-400 disabled:bg-gray-100 disabled:cursor-not-allowed text-gray-700"}),(0,s.jsx)("button",{onClick:S,className:"absolute right-4 text-violet-600 hover:text-violet-800 transition-colors cursor-pointer p-1",title:"Envoyer",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:(0,s.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})}),(0,s.jsx)("button",{onClick:()=>I(!E),className:"absolute right-12 text-gray-500 hover:text-violet-600 transition-colors cursor-pointer p-1 rounded-full ".concat(E?"bg-gray-100 text-violet-600":""),title:"Plus d'actions",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z",clipRule:"evenodd"})})}),E&&(0,s.jsxs)("div",{className:"absolute right-0 bottom-14 bg-white rounded-lg shadow-xl border border-gray-100 p-2 flex flex-col gap-1 min-w-[200px] z-10 animate-in fade-in slide-in-from-bottom-2 duration-200",children:[(0,s.jsxs)("button",{onClick:()=>{t&&k(),h(!0),I(!1)},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,s.jsx)("span",{className:"text-xl",children:"\uD83D\uDCF8"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Prendre photo"})]}),(0,s.jsxs)("button",{onClick:()=>{f(!0),I(!1)},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,s.jsx)("span",{className:"text-xl",children:"\uD83D\uDDBC️"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Galerie"})]}),(0,s.jsx)("div",{className:"h-px bg-gray-100 my-1"}),(0,s.jsxs)("button",{onClick:async()=>{I(!1);try{if(!navigator.getBattery)return void alert("Cette fonctionnalit\xe9 n'est pas support\xe9e sur votre appareil (ex: iOS).");let e=await navigator.getBattery(),t=Math.round(100*e.level),a=t>20?"\uD83D\uDD0B":"\uD83E\uDEAB",s=e.charging?"⚡":"";C.sendMessage("".concat(a," J'ai ").concat(t,"% de batterie ").concat(s))}catch(e){console.error(e),alert("Impossible d'acc\xe9der aux infos de batterie")}},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,s.jsx)("span",{className:"text-xl",children:"⚡"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Partager batterie"})]}),(0,s.jsxs)("button",{onClick:()=>{if(I(!1),!navigator.geolocation)return void alert("La g\xe9olocalisation n'est pas support\xe9e par votre navigateur.");navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:a}=e.coords,s="https://www.google.com/maps?q=".concat(t,",").concat(a);C.sendMessage("\uD83D\uDCCD Ma position : ".concat(s))},e=>{console.error("Erreur g\xe9olocalisation:",e),alert("Impossible de r\xe9cup\xe9rer votre position (autorisation refus\xe9e ?)")})},className:"flex items-center gap-3 px-3 py-2 hover:bg-violet-50 rounded-md text-gray-700 transition-colors text-left",children:[(0,s.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCD"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Partager position"})]})]})]})]})]}):(0,s.jsx)("p",{className:"text-gray-500",children:"S\xe9lectionnez une room pour commencer \xe0 discuter"}),g&&(0,s.jsx)(d,{onPhotoTaken:e=>{a(e),h(!1)},onClose:()=>h(!1)}),(0,s.jsx)(u,{isOpen:x,onClose:()=>f(!1),onSelectPhoto:e=>{a(e),f(!1)}}),(0,s.jsx)(m.A,{imageData:j,onClose:()=>y(null)})]})}},6710:(e,t,a)=>{"use strict";a.d(t,{default:()=>i});var s=a(5155),o=a(2115),r=a(7621),n=a(9293),l=a(9262);function i(){let[e,t]=(0,o.useState)([]),[a,i]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),{pseudo:u}=(0,n.A)(),m=(0,l.F)(),[g,h]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{let e=await (0,r.Fd)("/rooms");(null==e?void 0:e.data)&&t(Object.keys(e.data))})()},[]);let x=e=>{m&&m.joinRoom(e,u)},f=async()=>{""!==a.trim()&&(x(encodeURIComponent(a.trim())),i(""),h(!1))},p=e.filter(e=>decodeURIComponent(e).toLowerCase().includes(c.toLowerCase()));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"h-[calc(100vh-57px)] w-2/7 flex flex-col p-4 border-r border-gray-300 bg-gray-50",children:[(0,s.jsxs)("div",{className:"mb-4 flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Conversations"}),(0,s.jsx)("button",{onClick:()=>h(!0),className:"w-[32px] h-[32px] aspect-square bg-violet-600 text-white rounded-full cursor-pointer text-xl flex items-center justify-center hover:bg-violet-700 transition-colors shadow-sm",children:"+"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",placeholder:"Rechercher...",value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 pl-9 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-violet-400 bg-white shadow-sm transition-all"}),(0,s.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\uD83D\uDD0D"})]})]}),(0,s.jsx)("div",{className:"overflow-y-auto flex flex-col gap-2 flex-1",children:p.length>0?p.map(e=>(0,s.jsx)("div",{onClick:()=>x(e),className:"w-full bg-white border-l-4 ".concat(e===(null==m?void 0:m.currentRoom)?"border-violet-600 bg-violet-50":"border-transparent"," hover:border-violet-600 hover:bg-violet-50 transition-all cursor-pointer p-4 rounded-r-lg shadow-sm flex justify-between items-center"),children:(0,s.jsx)("p",{className:"truncate font-medium text-[15px] text-gray-700",children:decodeURIComponent(e)})},e)):(0,s.jsx)("div",{className:"text-center text-gray-400 mt-4 text-sm",children:"Aucune conversation trouv\xe9e"})})]}),g&&(0,s.jsxs)("div",{className:"w-screen h-screen overflow-hidden absolute top-0 left-0 z-20",children:[(0,s.jsx)("div",{className:"w-full h-full bg-black opacity-70 flex justify-center items-center",onClick:()=>h(!1)}),(0,s.jsxs)("div",{className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-6 py-4 rounded-lg flex flex-col items-start gap-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Cr\xe9er une nouvelle conversation"}),(0,s.jsx)("input",{type:"text",className:"w-full border-1 border-black p-1 rounded-md",value:a,onChange:e=>i(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"Nom de la conversation"}),(0,s.jsx)("button",{onClick:f,className:"bg-violet-600 px-4 py-1 cursor-pointer rounded-md text-white",children:"Cr\xe9er"})]})]})]})}},6976:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var s=a(5155);function o(e){let{imageData:t,onClose:a}=e;return t?(0,s.jsx)("div",{className:"bg-black/70 fixed inset-0 flex items-center justify-center z-50",onClick:a,children:(0,s.jsxs)("div",{className:"relative max-w-4xl max-h-[90vh] p-4",children:[(0,s.jsx)("img",{src:t,alt:"Image agrandie",className:"max-w-full max-h-full object-contain rounded-lg"}),(0,s.jsx)("button",{onClick:a,className:"absolute top-6 right-6 w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors",children:"✕"})]})}):null}},7621:(e,t,a)=>{"use strict";async function s(e){try{let t="".concat("https://api.tools.gavago.fr/socketio/api").concat(e),a=await fetch(t,{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok)throw Error("Erreur HTTP! Statut: ".concat(a.status));return await a.json()}catch(e){return{error:e.message}}}async function o(e,t){try{let a=await fetch("/api/images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,image_data:t})});if(!a.ok)throw Error("Erreur HTTP! Statut: ".concat(a.status));return await a.json()}catch(e){return{error:e.message}}}async function r(e){try{let t=await fetch("/api/images?id=".concat(e),{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok)throw Error("Erreur HTTP! Statut: ".concat(t.status));return await t.json()}catch(e){return{error:e.message}}}a.d(t,{Fd:()=>s,Qp:()=>r,gj:()=>o})},9262:(e,t,a)=>{"use strict";a.d(t,{F:()=>i,SocketProvider:()=>l});var s=a(5155),o=a(2115),r=a(9829);let n=(0,o.createContext)(null),l=e=>{let{children:t}=e,[a,l]=(0,o.useState)(null),[i,c]=(0,o.useState)(null),[d,u]=(0,o.useState)("undefined"==typeof navigator||navigator.onLine),m=(0,o.useRef)(void 0),g=(0,o.useRef)(void 0);(0,o.useEffect)(()=>{let e=()=>u(!0),t=()=>u(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let h=(e,t)=>{let a=JSON.parse(localStorage.getItem("offline_queue")||"[]");if(0===a.length)return;let s=t||i;if(!s)return;console.log("\uD83C\uDF10 Traitement file d'attente pour la room : ".concat(s));let o=a.filter(e=>e.roomName===s),r=a.filter(e=>e.roomName!==s);0!==o.length&&(console.log("\uD83D\uDE80 Envoi de ".concat(o.length," messages pour ").concat(s,"...")),o.forEach(t=>{e.emit("chat-msg",{content:t.content,roomName:t.roomName}),t.tempId&&g.current&&g.current(t.tempId)}),localStorage.setItem("offline_queue",JSON.stringify(r)))};(0,o.useEffect)(()=>{let e=(0,r.io)("https://api.tools.gavago.fr",{transports:["websocket"],autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0});return e.on("connect",()=>{console.log("\uD83D\uDFE2 Connect\xe9 au serveur Socket.IO"),setTimeout(()=>{i&&h(e,i)},500)}),e.on("disconnect",e=>{console.log("\uD83D\uDD34 D\xe9connect\xe9 du serveur Socket.IO",e)}),e.on("connect_error",e=>{console.log("⚠️ Erreur de connexion Socket.IO",e)}),l(e),()=>{e.disconnect()}},[]);let x=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s="temp_".concat(Date.now(),"_").concat(Math.random()),o=JSON.parse(localStorage.getItem("offline_queue")||"[]");o.push({content:e,roomName:t,timestamp:Date.now(),tempId:s,isImage:a}),localStorage.setItem("offline_queue",JSON.stringify(o)),m.current&&m.current({content:e,pseudo:null,pending:!0,tempId:s,imageData:a?e:void 0,dateEmis:new Date().toISOString()})};return(0,s.jsx)(n.Provider,{value:{socket:a,currentRoom:i,joinRoom:(e,t)=>{a&&i!==e&&(a.off("chat-join-room"),c(null),a.emit("chat-join-room",{pseudo:t,roomName:e}),c(e),a.connected&&(console.log("Variante joinRoom : V\xe9rification messages en attente..."),h(a,e)))},sendMessage:e=>{if(i){if(!d)return void x(e,i);a&&a.connected?a.timeout(5e3).emit("chat-msg",{content:e,roomName:i},t=>{t&&x(e,i)}):x(e,i)}},sendImageMessage:e=>{if(i){if(!d)return void x(e,i,!0);a&&a.connected?a.timeout(5e3).emit("chat-msg",{content:e,roomName:i},t=>{t&&x(e,i,!0)}):x(e,i,!0)}},getMessages:e=>{a&&(a.off("chat-msg"),a.on("chat-msg",t=>{e(t)}))},setPendingMessageCallback:e=>{m.current=e},setMessageSentCallback:e=>{g.current=e}},children:t})},i=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useSocket must be used within a SocketProvider");return e}},9293:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,AuthProvider:()=>n});var s=a(5155),o=a(2115);let r=(0,o.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,o.useState)(null);return(0,o.useEffect)(()=>{n(localStorage.getItem("pseudo"))},[]),(0,s.jsx)(r.Provider,{value:{pseudo:a,setPseudo:n,clearUser:()=>{localStorage.removeItem("pseudo"),n(null)},registerUser:e=>{localStorage.setItem("pseudo",e),n(e)}},children:t})}function l(){return(0,o.useContext)(r)}}},e=>{e.O(0,[829,441,255,358],()=>e(e.s=59)),_N_E=e.O()}]);