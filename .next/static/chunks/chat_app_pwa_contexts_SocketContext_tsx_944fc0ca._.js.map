{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/aubin/htdocs/chat_app_pwa/contexts/SocketContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState, useRef } from \"react\";\r\nimport { io, Socket } from \"socket.io-client\";\r\nimport { Message } from \"@/types/chat\";\r\n\r\ninterface SocketContextType {\r\n    socket: Socket | null;\r\n    currentRoom: string | null;\r\n    joinRoom: (roomName: string, pseudo: string | null) => void;\r\n    sendMessage: (message: string, pseudo?: string | null) => void;\r\n    sendImageMessage: (imageData: string) => void;\r\n    getMessages: (callback: (data: Message) => void) => void;\r\n}\r\n\r\nconst SocketContext = createContext<SocketContextType | null>(null);\r\n\r\nexport const SocketProvider = ({ children }: { children: React.ReactNode }) => {\r\n    const [socket, setSocket] = useState<Socket | null>(null);\r\n    const [currentRoom, setCurrentRoom] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        const newSocket = io(\"https://api.tools.gavago.fr\", {\r\n            transports: [\"websocket\"],\r\n            autoConnect: true,\r\n            reconnection: true,\r\n            reconnectionAttempts: Infinity\r\n        });\r\n\r\n        newSocket.on(\"connect\", () => {\r\n            console.log(\"ðŸŸ¢ ConnectÃ© au serveur Socket.IO\");\r\n        });\r\n\r\n        newSocket.on(\"disconnect\", (reason) => {\r\n            console.log(\"ðŸ”´ DÃ©connectÃ© du serveur Socket.IO\", reason);\r\n        });\r\n\r\n        newSocket.on(\"connect_error\", (error) => {\r\n            console.log(\"âš ï¸ Erreur de connexion Socket.IO\", error);\r\n        });\r\n\r\n        setSocket(newSocket);\r\n\r\n        return () => {\r\n            newSocket.disconnect();\r\n        };\r\n    }, []);\r\n\r\n    const joinRoom = (roomName: string, pseudo: string | null) => {\r\n        if (!socket) return;\r\n\r\n        if (currentRoom === roomName) return;\r\n        socket.off(\"chat-join-room\");\r\n        setCurrentRoom(null);\r\n\r\n        socket.emit(\"chat-join-room\", { pseudo, roomName });\r\n        setCurrentRoom(roomName);\r\n    };\r\n\r\n    const sendMessage = (message: string) => {\r\n        if (!currentRoom || !socket) return;\r\n\r\n        socket.emit(\"chat-msg\", {\r\n            content: message,\r\n            roomName: currentRoom,\r\n        });\r\n    };\r\n\r\n    const sendImageMessage = (imageData: string) => {\r\n        if (!currentRoom || !socket) return;\r\n\r\n        socket.emit(\"chat-msg\", {\r\n            content: imageData,\r\n            roomName: currentRoom,\r\n        });\r\n    };\r\n\r\n    const getMessages = (callback: (data: Message) => void) => {\r\n        if (!socket) return;\r\n\r\n        socket.off(\"chat-msg\");\r\n        socket.on(\"chat-msg\", (data: Message) => {\r\n            callback(data);\r\n        });\r\n\r\n    };\r\n\r\n\r\n    return (\r\n        <SocketContext.Provider value={{\r\n            socket,\r\n            currentRoom,\r\n            joinRoom,\r\n            sendMessage,\r\n            sendImageMessage,\r\n            getMessages\r\n        }}>\r\n            {children}\r\n        </SocketContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useSocket = () => {\r\n    const context = useContext(SocketContext);\r\n    if (!context) {\r\n        throw new Error(\"useSocket must be used within a SocketProvider\");\r\n    }\r\n    return context;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AAeA,MAAM,8BAAgB,IAAA,8LAAa,EAA2B;AAEvD,MAAM,iBAAiB;QAAC,EAAE,QAAQ,EAAiC;;IACtE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yLAAQ,EAAgB;IACpD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yLAAQ,EAAgB;IAE9D,IAAA,0LAAS;oCAAC;YACN,MAAM,YAAY,IAAA,wMAAE,EAAC,+BAA+B;gBAChD,YAAY;oBAAC;iBAAY;gBACzB,aAAa;gBACb,cAAc;gBACd,sBAAsB;YAC1B;YAEA,UAAU,EAAE,CAAC;4CAAW;oBACpB,QAAQ,GAAG,CAAC;gBAChB;;YAEA,UAAU,EAAE,CAAC;4CAAc,CAAC;oBACxB,QAAQ,GAAG,CAAC,sCAAsC;gBACtD;;YAEA,UAAU,EAAE,CAAC;4CAAiB,CAAC;oBAC3B,QAAQ,GAAG,CAAC,oCAAoC;gBACpD;;YAEA,UAAU;YAEV;4CAAO;oBACH,UAAU,UAAU;gBACxB;;QACJ;mCAAG,EAAE;IAEL,MAAM,WAAW,CAAC,UAAkB;QAChC,IAAI,CAAC,QAAQ;QAEb,IAAI,gBAAgB,UAAU;QAC9B,OAAO,GAAG,CAAC;QACX,eAAe;QAEf,OAAO,IAAI,CAAC,kBAAkB;YAAE;YAAQ;QAAS;QACjD,eAAe;IACnB;IAEA,MAAM,cAAc,CAAC;QACjB,IAAI,CAAC,eAAe,CAAC,QAAQ;QAE7B,OAAO,IAAI,CAAC,YAAY;YACpB,SAAS;YACT,UAAU;QACd;IACJ;IAEA,MAAM,mBAAmB,CAAC;QACtB,IAAI,CAAC,eAAe,CAAC,QAAQ;QAE7B,OAAO,IAAI,CAAC,YAAY;YACpB,SAAS;YACT,UAAU;QACd;IACJ;IAEA,MAAM,cAAc,CAAC;QACjB,IAAI,CAAC,QAAQ;QAEb,OAAO,GAAG,CAAC;QACX,OAAO,EAAE,CAAC,YAAY,CAAC;YACnB,SAAS;QACb;IAEJ;IAGA,qBACI,6MAAC,cAAc,QAAQ;QAAC,OAAO;YAC3B;YACA;YACA;YACA;YACA;YACA;QACJ;kBACK;;;;;;AAGb;GAnFa;KAAA;AAqFN,MAAM,YAAY;;IACrB,MAAM,UAAU,IAAA,2LAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;IANa","debugId":null}}]
}